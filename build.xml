<?xml version="1.0" encoding="UTF-8" ?>

<project name="Carrot2 Website build/ publish script." default="help" basedir="." >

  <property name="website.src" value="src" />
  <property name="stylesheet" location="${website.src}/xsl/page.xsl" />

  <property name="website.properties" value="${user.home}/.carrot.website-upload.properties" />
  <property file="${website.properties}" />

  <property name="distribution.dir" value="tmp/dist" />

  <property name="website.website.upload.dir" value="project.carrot2.org" />

  <target name="clean" description="Removes all temporary files.">
        <delete failonerror="false" includeemptydirs="true" quiet="true">
            <fileset dir="tmp" />
        </delete>
  </target>

  <target name="xslt" description="Transforms the website XML sources to HTML files">
      <tstamp>
          <format property="build.time" pattern="d MMMM yyyy" locale="en" />
      </tstamp>

      <xslt basedir="${website.src}" destdir="${distribution.dir}" style="${stylesheet}">
          <include name="*.xml" />

          <outputproperty name="method" value="xml" />
          <outputproperty name="standalone" value="yes"/>
          <outputproperty name="encoding" value="UTF-8"/>
          <outputproperty name="indent" value="no" />

          <param name="content-extension" expression="html" />
          <param name="build.time" expression="${build.time}" />
      </xslt>
      
      <copy todir="${distribution.dir}" filtering="false">
          <fileset dir="${website.src}">
              <exclude name="**/*.bat" />
              <exclude name="**/*.sh" />
              <exclude name="**/*.swp" />
              <exclude name="**/*.xml" />
              <exclude name="**/*.xsl" />
              <exclude name="xsl" />
              <exclude name="xml" />
              <exclude name="**/favicon.ico" />
          </fileset>
          <fileset dir="${website.src}/img">
            <include name="favicon.ico" />
          </fileset>
      </copy>
  </target>

  <target name="upload" depends="xslt" description="Uploads the website to the server">
    <fail unless="website.upload.host">Please define the website.upload.host variable</fail>
    <fail unless="website.upload.user">Please define the website.upload.user variable</fail>
    <fail unless="website.upload.password">Please define the website.upload.password variable</fail>
    <fail unless="website.website.upload.dir">Please define the website.website.upload.dir variable</fail>
    <echo>
####
Uploading website to: ${website.upload.host}/${website.website.upload.dir}
####
    </echo> 
    <ftp server="${website.upload.host}"
         userid="${website.upload.user}"
         password="${website.upload.password}"
         remotedir="${website.website.upload.dir}"
         depends="yes"
         verbose="yes"
         passive="yes">
      <fileset dir="${distribution.dir}"/>
    </ftp>
  </target>

  <target name="help" description="Displays help on available targets.">
    <echo>

    Current JDK: ${ant.java.version}
    Basedir    : ${basedir}
    -----------------------------------------------------

    Type ant -projecthelp for more information about available tasks.
    
    </echo>
  </target>
  <!-- }}} -->

</project>

